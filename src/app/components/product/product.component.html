<main>

<section>
  <div class="container">
    <div class="row">
      <div class="col-12 card mb-15">
        <div class="row">
          <div class="col-6 product-gallery">
            <img [src]="mainImageUrl">
          </div>
          <div class="col-6 product-info">
            <div class="product-info-wrapper">
              <div class="d-flex w-100 align-items-top mb-15">
                <h4 class="title w-100 mb-0 mt-7">{{ (product)?.title }}</h4>
                <div class="d-flex flex-column justify-content-end">
                  <div class="d-flex align-items-center">
                    <ngb-rating [rate]="rating" [readonly]="true" [max]="5">
                      <ng-template let-fill="fill" let-index="index">
                        <span class="star" [class.full]="fill === 100">
                          <span class="half" [style.width.%]="fill">&#9733;</span>&#9733;
                        </span>
                      </ng-template>
                    </ngb-rating>
                    <small class="ml-7 mr-15">{{rating | number : '1.2-2'}}</small>
                  </div>
                  <a *ngIf="reviews.length" class="d-flex align-self-end mr-15" href="./"><small>{{ (reviews)?.length }} reviews</small></a>
                </div>

              </div>


              <p>Rentor: &nbsp;<a [routerLink]="'../../profile/'+ (user)?._id">{{ (user)?.firstName }} {{ (user)?.lastName }}</a></p>
              <p>Location: &nbsp;<span>Bucharest</span></p>
              <div class="product-info-group">
                <p>Price: &nbsp;
                  <span class="price">{{ (product)?.price }}€</span>
                  <span class="price-per">/{{ (product)?.pricePer }}</span>
                </p>
              </div>
              <div class="rent-wrapper">
                <span class="field-name">Period</span>
                <ngb-datepicker #dp ngModel (select)="onDateSelection($event)" [displayMonths]="2" [dayTemplate]="t" [markDisabled]="isDisabled" (navigate)="onNavigateEvent($event)">
                </ngb-datepicker>

                <ng-template #t let-date="date" let-focused="focused">
                  <span class="custom-day" [class.focused]="focused" [class.range]="isFrom(date) || isTo(date) || isInside(date) || isHovered(date)"
                    [class.faded]="isHovered(date) || isInside(date)" (mouseenter)="hoveredDate = date" (mouseleave)="hoveredDate = null">
                    {{ date.day }}
                  </span>
                </ng-template>
                <div class="period-wrapper">
                  <div>
                    <span class="field-name">From</span>
                    <div class="d-flex align-items-center">
                      <input class="form-control" placeholder="yyyy-mm-dd" name="start-date" [(ngModel)]="fromDate" (ngModelChange)="revertFromDate($event)" ngbDatepicker [markDisabled]="isDisabled"
                        #d="ngbDatepicker" disabled>
                      <ngb-timepicker [(ngModel)]="fromTime" [seconds]="false" [hourStep]="hourStep" [minuteStep]="minuteStep" [spinners]="false"></ngb-timepicker>
                    </div>
                  </div>

                  <fa name="angle-double-right"></fa>
                  <div>
                    <span class="field-name">To</span>
                    <div class="d-flex align-items-center">
                      <input class="form-control" placeholder="yyyy-mm-dd" name="end-date" [(ngModel)]="toDate" (ngModelChange)="revertToDate($event)" ngbDatepicker [markDisabled]="isDisabled"
                        #d="ngbDatepicker" disabled>
                      <ngb-timepicker [(ngModel)]="toTime" [seconds]="false" [hourStep]="hourStep" [minuteStep]="minuteStep" [spinners]="false"></ngb-timepicker>
                    </div>
                  </div>
                </div>
                <div class="mb-7 d-flex w-100 justify-content-center">
                    <span class="available">maximum {{ (product)?.quantity }} available <span *ngIf="fromDate && toDate">, out of witch {{(product)?.quantity - maxim}} during this period</span>
                    </span>
                </div>
                <div class="rent-wrapper__segment">
                  <div class="d-flex">
                    <div class="align-self-start mr-15">
                      <span class="field-name">Todal {{ (product)?.pricePer}}s</span>
                      <input class="form-control" type="number" [(ngModel)]="count" disabled>
                    </div>
                    <div>
                      <span class="field-name">Quantity</span>
                      <div class="quantity-wrapper">
                        <span (click)="quantityMinus()">-</span>
                        <input type="number" value="1" min="1" max="100" [(ngModel)]="quantity" (ngModelChange)="doSomething($event)">
                        <span (click)="quantityPlus()">+</span>
                      </div>
                    </div>
                  </div>
                  <div>
                    <span class="field-name total">Total</span>
                    <span *ngIf="count>=0" class="price">{{ (product)?.price*count*quantity }}€</span>
                  </div>
                </div>
                <button class="button" (click)="showRentModal()">Rent it!</button>
              </div>
              <!-- <button class="button">Rent it!</button> -->
            </div>
          </div>
          <div class="col-12 description">
            <h5 class="mb-7">Description</h5>
            <!-- <span class="tab-space"></span> -->
            <pre><p>{{ (product)?.description }}</p></pre>
          </div>
        </div>
      </div>

      <div class="col-12 card mb-15">
        <button *ngIf="!reviewd" type="button" class="button-save" (click)="showRateModal()">
          <fa name="paper-plane"></fa>Review</button>
        <div class="reviews d-flex flex-column w-100">
          <div *ngFor="let r of reviews" class="card mt-15">
            <p>{{r.review}}</p>
            <ngb-rating [rate]="r.rating" [readonly]="true" [max]="5">
              <ng-template let-fill="fill" let-index="index">
                <span class="star" [class.filled]="fill === 100">&#9733;</span>
              </ng-template>
            </ngb-rating>
          </div>
        </div>
      </div>

      <div class="col-12 card">
        <form (ngSubmit)="postComment()" id="ngForm1" [formGroup]="formComments" #formTest="ngForm" novalidate class="d-flex flex-column">
          <textarea placeholder="" formControlName="comment" [ngClass]="{'has-error':(formTest.submitted && !formComments.controls['comment'].valid), 'has-success':(formTest.submitted && formComments.controls['comment'].valid)}"></textarea>
          <small *ngIf="formTest.submitted && formComments.controls['comment'].hasError('required')" class="text-danger">This field is mandatory</small>
          <small *ngIf="formTest.submitted && formComments.controls['comment'].hasError('maxlength')" class="text-danger">The message must contain maximum 10000 characters</small>
          <button type="submit" class="button-save" form="ngForm1">
            <fa name="paper-plane"></fa>Post</button>
        </form>
        <div class="comments d-flex flex-column w-100">
          <div *ngFor="let c of comments" class="card mt-15">
            <a [routerLink]="'../../profile/' + c._senderId">{{c.senderFirstName}} {{c.senderLastName}}</a>
            <p>{{c.comment}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

</main>